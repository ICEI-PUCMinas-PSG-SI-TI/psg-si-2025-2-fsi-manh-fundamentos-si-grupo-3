
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    
    const $ = (sel, root = document) => root.querySelector(sel);
    const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i;
    const uuid = () => (crypto.randomUUID ? crypto.randomUUID() : String(Date.now()));

    
    let dados = [];
    let filtro = "";
    let ordenacao = { campo: "nome", asc: true };

    
    const modeBadge = $("#modeBadge");
    const tbody = $("#tbody");
    const empty = $("#empty");
    const modalEl = $("#usuarioModal");
    const modal = new bootstrap.Modal(modalEl);
    const form = $("#formUsuario");
    const modalTitle = $("#modalTitle");
    const searchInput = $("#search");


    function carregarUsuarios() {
      try {
        const raw = localStorage.getItem('usuarios');
        return raw ? JSON.parse(raw) : [];
      } catch {
        return [];
      }
    }
    function salvarUsuarios(arr) {
      localStorage.setItem('usuarios', JSON.stringify(arr));
    }


    function formatarDataISO(iso) {
      return iso ? new Date(iso).toLocaleString() : '';
    }

    function aplicarFiltro(lista, termo) {
      if (!termo) return lista;
      const t = termo.toLowerCase();
      return lista.filter(u => (u.nome || '').toLowerCase().includes(t) || (u.email || '').toLowerCase().includes(t));
    }

    function ordenar(lista, campo, asc) {
      return [...lista].sort((a, b) => {
        const va = (a[campo] || '').toString().toLowerCase();
        const vb = (b[campo] || '').toString().toLowerCase();
        if (va < vb) return asc ? -1 : 1;
        if (va > vb) return asc ? 1 : -1;
        return 0;
      });
    }

    function renderizarCabecalhoOrdenacao() {
      $$("thead th[data-sort]").forEach(th => {
        th.classList.remove('asc','desc');
        if (th.dataset.sort === ordenacao.campo) {
          th.classList.add(ordenacao.asc ? 'asc' : 'desc');
        }
      });
    }

    function renderizarUsuarios(lista) {
      tbody.innerHTML = '';
      if (!lista || lista.length === 0) {
        empty.classList.remove('d-none');
        return;
      }
      empty.classList.add('d-none');
      for (const u of lista) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${u.nome || ''}</td>
          <td>${u.email || ''}</td>
          <td>${u.dataNasc || ''}</td>
          <td>${formatarDataISO(u.criadoEm)}</td>
          <td class="text-end">
            <button class="btn btn-sm btn-outline-secondary btn-edit" data-id="${u.id}">Editar</button>
            <button class="btn btn-sm btn-outline-danger btn-delete ms-1" data-id="${u.id}">Excluir</button>
          </td>`;
        tbody.appendChild(tr);
      }
    }

    function listar() {
      dados = carregarUsuarios();
      let lista = aplicarFiltro(dados, filtro);
      lista = ordenar(lista, ordenacao.campo, ordenacao.asc);
      renderizarCabecalhoOrdenacao();
      renderizarUsuarios(lista);
    }

    
    $("#btnNovo").addEventListener('click', () => {
      modalTitle.textContent = 'Novo usuário';
      form.reset();
      $('#id').value = '';
      modal.show();
    });

    $("#btnRecarregar").addEventListener('click', listar);

    searchInput.addEventListener('input', (e) => {
      filtro = e.target.value.trim();
      listar();
    });

    
    $$('thead th[data-sort]').forEach(th => {
      th.addEventListener('click', () => {
        const campo = th.dataset.sort;
        if (ordenacao.campo === campo) {
          ordenacao.asc = !ordenacao.asc;
        } else {
          ordenacao = { campo, asc: true };
        }
        listar();
      });
    });

    tbody.addEventListener('click', (e) => {
      const editBtn = e.target.closest('.btn-edit');
      const delBtn  = e.target.closest('.btn-delete');

      if (editBtn) {
        const id = editBtn.dataset.id;
        const usuario = dados.find(d => d.id === id);
        if (usuario) {
          modalTitle.textContent = 'Editar usuário';
          $('#id').value = usuario.id || '';
          $('#nome').value = usuario.nome || '';
          $('#email').value = usuario.email || '';
          $('#dataNasc').value = usuario.dataNasc || '';
          $('#senha').value = '';
          modal.show();
        }
        return;
      }

      if (delBtn) {
        const id = delBtn.dataset.id;
        if (!confirm('Confirma exclusão deste usuário?')) return;
        const usuarios = carregarUsuarios().filter(u => u.id !== id);
        salvarUsuarios(usuarios);
        listar();
        return;
      }
    });

    
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const id = $('#id').value;
      const nome = $('#nome').value.trim();
      const email = $('#email').value.trim();
      const dataNasc = $('#dataNasc').value || '';
      const senha = $('#senha').value || '';

      if (!nome) { alert('Nome é obrigatório.'); return; }
      if (!email || !emailRegex.test(email)) { alert('E-mail inválido.'); return; }

      const usuarios = carregarUsuarios();

      
      const existe = usuarios.some(u => String(u.email).toLowerCase() === email.toLowerCase() && u.id !== id);
      if (existe) { alert('Já existe um usuário com este e-mail.'); return; }

      if (id) {
        const idx = usuarios.findIndex(u => u.id === id);
        if (idx >= 0) {
          usuarios[idx].nome = nome;
          usuarios[idx].email = email;
          usuarios[idx].dataNasc = dataNasc;
          if (senha) usuarios[idx].senha = senha; 
        }
      } else {
        usuarios.push({
          id: uuid(),
          nome,
          email,
          dataNasc,
          senha,
          criadoEm: new Date().toISOString()
        });
      }

      salvarUsuarios(usuarios);
      modal.hide();
      listar();
    });

    
    (function init(){
      modeBadge.textContent = 'Modo: Local (localStorage)';
      modeBadge.className = 'badge text-bg-secondary badge-mode';
      listar();
    })();
  </script>



<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./cadastro.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <title>Cadastro - Saboreie</title>
  <style>
    .site-header {
      display: flex !important;         
      align-items: start !important;    
    }
    .header-text{
      margin-left: -49px;
    }
    .header-text h1 {
      margin: 0 !important;             
    }

    .header-text p {
      margin: 0 !important;              
      font-size: 16px !important;        
    }

          .btn-voltar {
    background: linear-gradient(90deg, #ff4612, #ff9c2b );
    color: white;
    border-radius: 25px;
    padding: 10px 20px;
    font-weight: bold;
    transition: background 0.3s ease;
    margin-top: 2vh;
    margin-left: 1vw;
  }

    footer{
      height: 20vh;
      margin-top: 15%;
    }

  </style>
</head> 
<body>
<header class="site-header">
  <img src="../docs/images/delivery-de-marmitex-caseiro-no-patio-iporanga-removebg-preview.png" style="width: 70px; height: 50px; margin: 0;" alt="Logo" id="logo">
  <div class="header-text">
    <h1>Saboreie</h1>
    <p class="subtitle">Cadastre-se para ter acesso ao nosso serviço</p>
  </div>
</header>
    <button class="btn btn-voltar" onclick="history.back()">&#8592; Voltar</button>

  <main style="margin-top: 20vh;">
    <form class="cadastro" id="cadastroForm" novalidate>
      <div class="form-group">
        <label for="nome">Nome Completo</label>
        <input type="text" id="nome" name="nome" required placeholder="Seu nome completo" />
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" name="email" required placeholder="Seu email" />
      </div>

      <div class="form-group">
        <label for="senha">Senha</label>
        <input type="password" id="senha" name="senha" required placeholder="Min. 8 caracteres" />
      </div>

      <div class="form-group">
        <label for="telefone">Telefone</label>
        <input type="tel" id="telefone" name="telefone" placeholder="(00) 00000-0000" />
      </div>

      <div class="form-group">
        <label for="dataNasc">Data de nascimento</label>
        <input type="date" id="dataNasc" name="dataNasc" />
      </div>

      <div class="form-group">
        <label>
          <input type="checkbox" id="termos" name="termos" /> 
          <p style="margin-left: 20%;">Aceito os termos de uso</p>
        </label>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary">Cadastrar</button>
        <br /><br />
        <button type="reset" class="btn btn-secondary">Limpar</button>
      </div>
    </form>
  </main>

  <footer>
    <p>&copy; 2025 Saboreie | Todos os direitos reservados.</p>
  </footer>

  <script>
    (function() {
      const form = document.getElementById('cadastroForm');
      const nomeEl = document.getElementById('nome');
      const emailEl = document.getElementById('email');
      const senhaEl = document.getElementById('senha');
      const telefoneEl = document.getElementById('telefone');
      const dataNascEl = document.getElementById('dataNasc');
      const termosEl = document.getElementById('termos');

      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i;

      function carregarUsuarios() {
        try {
          const raw = localStorage.getItem('usuarios');
          return raw ? JSON.parse(raw) : [];
        } catch {
          return [];
        }
      }
      function salvarUsuarios(arr) {
        localStorage.setItem('usuarios', JSON.stringify(arr));
      }
      function emailExistente(email) {
        return carregarUsuarios().some(u => String(u.email).toLowerCase() === String(email).toLowerCase());
      }

      form.addEventListener('submit', (e) => {
        e.preventDefault();
        const nome = nomeEl.value.trim();
        const email = emailEl.value.trim();
        const senha = senhaEl.value;
        const telefone = telefoneEl.value.trim();
        const dataNasc = dataNascEl ? dataNascEl.value : '';
        const role = "cliente"
        const termos = termosEl ? termosEl.checked : false;

        if (!nome) { alert('Informe seu nome.'); nomeEl.focus(); return; }
        if (!email || !emailRegex.test(email)) { alert('Informe um e-mail válido.'); emailEl.focus(); return; }
        if (!senha || senha.length < 8) { alert('A senha deve ter pelo menos 8 caracteres.'); senhaEl.focus(); return; }
        if (!termos) { alert('Você precisa aceitar os termos.'); termosEl.focus(); return; }
        if (emailExistente(email)) { alert('Este e-mail já está cadastrado.'); emailEl.focus(); return; }

        const usuario = {
          id: (crypto && crypto.randomUUID ? crypto.randomUUID() : String(Date.now())),
          nome,
          email,
          senha,
          telefone,
          dataNasc,
          role,
          criadoEm: new Date().toISOString()
        };

        const usuarios = carregarUsuarios();
        usuarios.push(usuario);
        salvarUsuarios(usuarios);

        form.reset();
        alert('Cadastro realizado com sucesso!');
        window.location.href = 'index.html';
      });
    })();
  </script>
</body>
</html>
